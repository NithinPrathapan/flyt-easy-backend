<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlytEasy - Hotel Results</title>
    <link rel="icon" type="image/svg+xml" href="./assets//img/favicon.png"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/hotel-results.css"/>
</head>
<body>
    <div class="container-fluid hotel-results-container p-0">
        <!-- Header -->
        <nav class="navbar search-header p-3 border-bottom d-flex justify-content-between align-items-center shadow-sm fixed-top">
            <div class="d-flex align-items-center">
                <svg class="lucide-icon me-2" style="cursor: pointer" onclick="goBack()">
                    <path d="m12 19-7-7 7-7"/>
                    <path d="M19 12H5"/>
                </svg>
                <div>
                    <div class="route-info">Mumbai Hotels</div>
                    <div class="travel-info text-muted">
                        25 Jun - 27 Jun | 1 Room, 2 Adults
                    </div>
                </div>
            </div>
            <button class="btn filter-btn d-flex align-items-center" onclick="toggleFilters()">
                <svg class="lucide-icon me-2">
                    <line x1="21" x2="14" y1="4" y2="4"/>
                    <line x1="10" x2="3" y1="4" y2="4"/>
                    <line x1="21" x2="12" y1="12" y2="12"/>
                    <line x1="8" x2="3" y1="12" y2="12"/>
                    <line x1="21" x2="16" y1="20" y2="20"/>
                    <line x1="12" x2="3" y1="20" y2="20"/>
                    <line x1="14" x2="14" y1="2" y2="6"/>
                    <line x1="8" x2="8" y1="10" y2="14"/>
                    <line x1="16" x2="16" y1="18" y2="22"/>
                </svg>
                Filter
            </button>
        </nav>

        <!-- Hotel Results -->
        <div class="hotel-results p-2 mt-5 pt-5 flex-grow-1 pb-5" id="hotelResults">
            <!-- Hotel cards will be inserted here by JavaScript -->
        </div>

        <!-- Filter Panel Overlay -->
        <div class="offcanvas offcanvas-end filter-panel" tabindex="-1" id="filterOffcanvas">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title small">
                    Filter Your Search
                    <div class="text-muted small">45 of 45 results</div>
                </h5>
                <button type="button" class="btn-close" onclick="toggleFilters()"></button>
            </div>
            <div class="offcanvas-body">
                <!-- Price Filters -->
                <div class="filter-section mb-4">
                    <h6 class="filter-heading mb-3">PRICE PER NIGHT</h6>
                    <div class="d-flex flex-wrap gap-2">
                        <button class="btn btn-outline-secondary rounded-pill price-filter-btn" data-price="1000-3000">
                            ₹1000 - 3000
                        </button>
                        <button class="btn btn-outline-secondary rounded-pill price-filter-btn" data-price="3000-5000">
                            ₹3000 - 5000
                        </button>
                        <button class="btn btn-outline-secondary rounded-pill price-filter-btn" data-price="5000-10000">
                            ₹5000 - 10000
                        </button>
                        <button class="btn btn-outline-secondary rounded-pill price-filter-btn" data-price="above-10000">
                            Above ₹10000
                        </button>
                    </div>
                </div>

                <!-- Star Rating Filters -->
                <div class="filter-section mb-4">
                    <h6 class="filter-heading mb-3">STAR RATING</h6>
                    <div class="form-check star-filter-checkbox mb-2">
                        <input class="form-check-input" type="checkbox" id="five-star-checkbox" data-stars="5"/>
                        <label class="form-check-label" for="five-star-checkbox">
                            <div class="d-flex align-items-center">
                                <div class="stars me-2">⭐⭐⭐⭐⭐</div>
                                <div>5 Star</div>
                            </div>
                        </label>
                    </div>
                    <div class="form-check star-filter-checkbox mb-2">
                        <input class="form-check-input" type="checkbox" id="four-star-checkbox" data-stars="4"/>
                        <label class="form-check-label" for="four-star-checkbox">
                            <div class="d-flex align-items-center">
                                <div class="stars me-2">⭐⭐⭐⭐</div>
                                <div>4 Star</div>
                            </div>
                        </label>
                    </div>
                    <div class="form-check star-filter-checkbox mb-2">
                        <input class="form-check-input" type="checkbox" id="three-star-checkbox" data-stars="3"/>
                        <label class="form-check-label" for="three-star-checkbox">
                            <div class="d-flex align-items-center">
                                <div class="stars me-2">⭐⭐⭐</div>
                                <div>3 Star</div>
                            </div>
                        </label>
                    </div>
                    <div class="form-check star-filter-checkbox mb-2">
                        <input class="form-check-input" type="checkbox" id="two-star-checkbox" data-stars="2"/>
                        <label class="form-check-label" for="two-star-checkbox">
                            <div class="d-flex align-items-center">
                                <div class="stars me-2">⭐⭐</div>
                                <div>2 Star</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Amenities Filters -->
                <div class="filter-section mb-4">
                    <h6 class="filter-heading mb-3">AMENITIES</h6>
                    <div class="form-check amenity-filter-checkbox mb-2">
                        <input class="form-check-input" type="checkbox" id="wifi-checkbox" data-amenity="wifi"/>
                        <label class="form-check-label" for="wifi-checkbox">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-wifi me-2 text-primary"></i>
                                <div>Free WiFi</div>
                            </div>
                        </label>
                    </div>
                    <div class="form-check amenity-filter-checkbox mb-2">
                        <input class="form-check-input" type="checkbox" id="parking-checkbox" data-amenity="parking"/>
                        <label class="form-check-label" for="parking-checkbox">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-parking me-2 text-primary"></i>
                                <div>Free Parking</div>
                            </div>
                        </label>
                    </div>
                    <div class="form-check amenity-filter-checkbox mb-2">
                        <input class="form-check-input" type="checkbox" id="pool-checkbox" data-amenity="pool"/>
                        <label class="form-check-label" for="pool-checkbox">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-swimming-pool me-2 text-primary"></i>
                                <div>Swimming Pool</div>
                            </div>
                        </label>
                    </div>
                    <div class="form-check amenity-filter-checkbox mb-2">
                        <input class="form-check-input" type="checkbox" id="gym-checkbox" data-amenity="gym"/>
                        <label class="form-check-label" for="gym-checkbox">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-dumbbell me-2 text-primary"></i>
                                <div>Fitness Center</div>
                            </div>
                        </label>
                    </div>
                    <div class="form-check amenity-filter-checkbox mb-2">
                        <input class="form-check-input" type="checkbox" id="restaurant-checkbox" data-amenity="restaurant"/>
                        <label class="form-check-label" for="restaurant-checkbox">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-utensils me-2 text-primary"></i>
                                <div>Restaurant</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Location Filters -->
                <div class="filter-section mb-4">
                    <h6 class="filter-heading mb-3">LOCATION</h6>
                    <div class="form-check location-filter-checkbox mb-2">
                        <input class="form-check-input" type="checkbox" id="airport-checkbox" data-location="airport"/>
                        <label class="form-check-label" for="airport-checkbox">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-plane me-2 text-primary"></i>
                                <div>Near Airport</div>
                            </div>
                        </label>
                    </div>
                    <div class="form-check location-filter-checkbox mb-2">
                        <input class="form-check-input" type="checkbox" id="city-center-checkbox" data-location="cityCenter"/>
                        <label class="form-check-label" for="city-center-checkbox">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-city me-2 text-primary"></i>
                                <div>City Center</div>
                            </div>
                        </label>
                    </div>
                    <div class="form-check location-filter-checkbox mb-2">
                        <input class="form-check-input" type="checkbox" id="beach-checkbox" data-location="beach"/>
                        <label class="form-check-label" for="beach-checkbox">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-umbrella-beach me-2 text-primary"></i>
                                <div>Near Beach</div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            <div class="filter-actions d-flex">
                <button class="btn btn-outline-primary flex-grow-1 me-2" onclick="resetAllFilters()">
                    <div class="d-flex align-items-center justify-content-center">
                        <svg class="me-2" width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M3 12C3 16.9706 7.02944 21 12 21C16.9706 21 21 16.9706 21 12C21 7.02944 16.9706 3 12 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M9 3L3 3L3 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Reset All
                    </div>
                </button>
                <button class="btn btn-primary flex-grow-1" onclick="applyFilters()">
                    Apply
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Hotel data - will be populated from backend
        let hotels = [];
        let searchDetails = {};

        // State variables
        let selectedHotel = null;
        let filters = {
            price: '',
            stars: {},
            amenities: {},
            location: {}
        };

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadHotelData();
            renderHotels();
            setupEventListeners();
            updateHeaderInfo();
        });

        function loadHotelData() {
            try {
                // Get search results from localStorage (set by hotel-search.html)
                const searchResults = JSON.parse(localStorage.getItem('hotelSearchResults'));
                console.log('Search results from localStorage:', searchResults);
                
                if (searchResults && searchResults.success && searchResults.data) {
                    // Extract hotel data from the backend response
                    const hotelData = searchResults.data;
                    console.log('Raw hotel data from backend:', hotelData);
                    
                    // Transform backend data to frontend format
                    hotels = transformHotelData(hotelData);
                    
                    // Get search details for header
                    const searchData = JSON.parse(localStorage.getItem('hotelSearchData') || '{}');
                    searchDetails = searchData;
                    
                    console.log('Transformed hotels:', hotels);
                } else {
                    console.error('No valid search results found in localStorage or search was unsuccessful.');
                    showNoResultsMessage();
                }
            } catch (error) {
                console.error('Error loading hotel data:', error);
                showNoResultsMessage();
            }
        }

        function transformHotelData(backendData) {
            console.log('Transforming backend data:', backendData);
            
            // For now, return sample data until backend integration
            return [
                {
                    id: 1,
                    name: "Taj Mahal Palace",
                    location: "Colaba, Mumbai",
                    rating: 5,
                    price: 8500,
                    originalPrice: 12000,
                    discount: 3500,
                    image: "https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400",
                    amenities: ["wifi", "pool", "gym", "restaurant"],
                    distance: "2.5 km from city center",
                    reviews: 1247,
                    ratingScore: 4.8
                },
                {
                    id: 2,
                    name: "The Oberoi Mumbai",
                    location: "Nariman Point, Mumbai",
                    rating: 5,
                    price: 12000,
                    originalPrice: 15000,
                    discount: 3000,
                    image: "https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?w=400",
                    amenities: ["wifi", "parking", "pool", "gym", "restaurant"],
                    distance: "1.8 km from city center",
                    reviews: 892,
                    ratingScore: 4.9
                },
                {
                    id: 3,
                    name: "ITC Maratha",
                    location: "Andheri East, Mumbai",
                    rating: 5,
                    price: 6500,
                    originalPrice: 9000,
                    discount: 2500,
                    image: "https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=400",
                    amenities: ["wifi", "parking", "pool", "restaurant"],
                    distance: "8.2 km from city center",
                    reviews: 567,
                    ratingScore: 4.6
                },
                {
                    id: 4,
                    name: "The Leela Mumbai",
                    location: "Sahar, Mumbai",
                    rating: 5,
                    price: 9500,
                    originalPrice: 13000,
                    discount: 3500,
                    image: "https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?w=400",
                    amenities: ["wifi", "parking", "pool", "gym", "restaurant"],
                    distance: "12.5 km from city center",
                    reviews: 734,
                    ratingScore: 4.7
                },
                {
                    id: 5,
                    name: "Trident Nariman Point",
                    location: "Nariman Point, Mumbai",
                    rating: 4,
                    price: 4500,
                    originalPrice: 6000,
                    discount: 1500,
                    image: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400",
                    amenities: ["wifi", "parking", "restaurant"],
                    distance: "2.1 km from city center",
                    reviews: 445,
                    ratingScore: 4.4
                }
            ];
        }

        function showNoResultsMessage() {
            hotels = [];
            const container = document.getElementById('hotelResults');
            container.innerHTML = `
                <div class="text-center py-5">
                    <div class="text-muted mb-3">
                        <i class="fas fa-hotel fa-3x mb-3"></i>
                        <h5>No hotels found</h5>
                        <p>We couldn't find any hotels matching your search criteria.</p>
                        <p class="small text-muted">Please try different dates or destinations.</p>
                    </div>
                    <button class="btn btn-primary" onclick="goBack()">Modify Search</button>
                </div>
            `;
        }

        function updateHeaderInfo() {
            try {
                const searchData = JSON.parse(localStorage.getItem('hotelSearchData') || '{}');
                
                // Update route info
                const destination = searchData.destination?.name || 'Mumbai';
                const routeInfo = document.querySelector('.route-info');
                if (routeInfo) {
                    routeInfo.textContent = `${destination} Hotels`;
                }

                // Update travel info
                const checkIn = searchData.checkIn || '25 Jun';
                const checkOut = searchData.checkOut || '27 Jun';
                const rooms = searchData.guests?.rooms || 1;
                const adults = searchData.guests?.adults || 2;
                
                const travelInfo = document.querySelector('.travel-info');
                if (travelInfo) {
                    travelInfo.textContent = `${checkIn} - ${checkOut} | ${rooms} Room${rooms > 1 ? 's' : ''}, ${adults} Adult${adults > 1 ? 's' : ''}`;
                }
            } catch (error) {
                console.error('Error updating header info:', error);
            }
        }

        function renderHotels() {
            const container = document.getElementById('hotelResults');
            container.innerHTML = '';

            if (hotels.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <div class="text-muted mb-3">No hotels found for your search criteria</div>
                        <button class="btn btn-primary" onclick="goBack()">Modify Search</button>
                    </div>
                `;
                return;
            }

            hotels.forEach(hotel => {
                const hotelCard = createHotelCard(hotel);
                container.appendChild(hotelCard);
            });
        }

        function createHotelCard(hotel) {
            const card = document.createElement('div');
            card.className = 'card hotel-card mb-3';
            card.onclick = () => openHotelDetails(hotel);

            const amenitiesIcons = hotel.amenities.map(amenity => {
                const iconMap = {
                    wifi: '<i class="fas fa-wifi text-primary"></i>',
                    parking: '<i class="fas fa-parking text-primary"></i>',
                    pool: '<i class="fas fa-swimming-pool text-primary"></i>',
                    gym: '<i class="fas fa-dumbbell text-primary"></i>',
                    restaurant: '<i class="fas fa-utensils text-primary"></i>'
                };
                return iconMap[amenity] || '';
            }).join('');

            card.innerHTML = `
                <div class="card-body p-0">
                    <div class="row g-0">
                        <div class="col-4">
                            <div class="hotel-image" style="background-image: url('${hotel.image}')">
                                <div class="hotel-rating">
                                    <span class="stars">${'⭐'.repeat(hotel.rating)}</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-8">
                            <div class="hotel-info p-3">
                                <div class="hotel-name fw-bold mb-1">${hotel.name}</div>
                                <div class="hotel-location text-muted small mb-2">
                                    <i class="fas fa-map-marker-alt me-1"></i>${hotel.location}
                                </div>
                                <div class="hotel-amenities mb-2">
                                    ${amenitiesIcons}
                                </div>
                                <div class="hotel-meta text-muted small mb-2">
                                    <span><i class="fas fa-star text-warning me-1"></i>${hotel.ratingScore} (${hotel.reviews} reviews)</span>
                                    <span class="ms-3"><i class="fas fa-location-arrow me-1"></i>${hotel.distance}</span>
                                </div>
                                <div class="hotel-price d-flex justify-content-between align-items-end">
                                    <div>
                                        <span class="original-price text-muted text-decoration-line-through me-2">₹${hotel.originalPrice}</span>
                                        <span class="final-price text-primary fw-bold">₹${hotel.price}</span>
                                        <div class="text-success small">Save ₹${hotel.discount}</div>
                                    </div>
                                    <button class="btn btn-outline-primary btn-sm">View Details</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            return card;
        }

        function openHotelDetails(hotel) {
            selectedHotel = hotel;
            // Store selected hotel for next page
            localStorage.setItem('selectedHotel', JSON.stringify(hotel));
            // Navigate to hotel details page
            window.location.href = '/hotel-details.html';
        }

        function setupEventListeners() {
            // Price filter buttons
            document.querySelectorAll('.price-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const price = this.dataset.price;
                    togglePriceFilter(price, this);
                });
            });

            // Checkbox filters
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateFilters();
                });
            });
        }

        function togglePriceFilter(price, button) {
            // Reset all price buttons
            document.querySelectorAll('.price-filter-btn').forEach(btn => {
                btn.className = 'btn btn-outline-secondary rounded-pill price-filter-btn';
            });

            // Toggle current button
            if (filters.price === price) {
                filters.price = '';
            } else {
                filters.price = price;
                button.className = 'btn btn-primary rounded-pill price-filter-btn';
            }
        }

        function updateFilters() {
            // Update star filters
            filters.stars = {
                5: document.getElementById('five-star-checkbox').checked,
                4: document.getElementById('four-star-checkbox').checked,
                3: document.getElementById('three-star-checkbox').checked,
                2: document.getElementById('two-star-checkbox').checked
            };

            // Update amenity filters
            filters.amenities = {
                wifi: document.getElementById('wifi-checkbox').checked,
                parking: document.getElementById('parking-checkbox').checked,
                pool: document.getElementById('pool-checkbox').checked,
                gym: document.getElementById('gym-checkbox').checked,
                restaurant: document.getElementById('restaurant-checkbox').checked
            };

            // Update location filters
            filters.location = {
                airport: document.getElementById('airport-checkbox').checked,
                cityCenter: document.getElementById('city-center-checkbox').checked,
                beach: document.getElementById('beach-checkbox').checked
            };
        }

        function toggleFilters() {
            const offcanvas = document.getElementById('filterOffcanvas');
            const isVisible = offcanvas.classList.contains('show');

            if (isVisible) {
                offcanvas.classList.remove('show');
                document.body.classList.remove('offcanvas-open');
                const backdrop = document.querySelector('.offcanvas-backdrop');
                if (backdrop) backdrop.remove();
            } else {
                offcanvas.classList.add('show');
                document.body.classList.add('offcanvas-open');
                const backdrop = document.createElement('div');
                backdrop.className = 'offcanvas-backdrop fade show';
                backdrop.onclick = toggleFilters;
                document.body.appendChild(backdrop);
            }
        }

        function resetAllFilters() {
            filters = {
                price: '',
                stars: {},
                amenities: {},
                location: {}
            };

            // Reset price buttons
            document.querySelectorAll('.price-filter-btn').forEach(btn => {
                btn.className = 'btn btn-outline-secondary rounded-pill price-filter-btn';
            });

            // Reset checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        function applyFilters() {
            // Apply filters logic here
            console.log('Applying filters:', filters);
            toggleFilters();
        }

        function goBack() {
            // Navigate back to search page
            window.location.href = '/hotel-search.html';
        }

        // Handle offcanvas backdrop clicks
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('offcanvas-backdrop')) {
                toggleFilters();
            }
        });

        // Handle escape key for offcanvas
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const offcanvas = document.getElementById('filterOffcanvas');
                if (offcanvas.classList.contains('show')) {
                    toggleFilters();
                }
            }
        });

        // Add Bootstrap offcanvas class for body when filter is open
        const style = document.createElement('style');
        style.textContent = `
            .offcanvas-open {
                overflow: hidden;
            }
            .offcanvas-backdrop {
                position: fixed;
                top: 0;
                left: 0;
                z-index: 1040;
                width: 100vw;
                height: 100vh;
                background-color: rgba(0, 0, 0, 0.5);
            }
            .offcanvas-backdrop.fade {
                opacity: 0;
            }
            .offcanvas-backdrop.show {
                opacity: 1;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html> 